{% extends 'base.html' %}

{% block extrahead %}
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
    <style>
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 auto;
            max-width: 1200px;
        }
    
        .main-content-profile {
            display: flex;
            width: 100%;
        }
    
        .courses-section {
            flex: 3;
            padding-right: 20px;
        }
    
        .sidebar-profile {
            flex: 1;
            background-color: #f8f8f8;
            padding: 20px;
            border-left: 1px solid #ddd;
        }
    
        #calendar {
            max-width: 100%;
            margin: 0 auto 20px auto;
        }
    
        .greeting {
            text-align: left;
            width: 100%;
        }
    </style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="main-content-profile">
        <div class="courses-section">
            <div class="greeting">
                <h2>{{ greeting | safe }}</h2>
            </div>

            <h3>Ваши курсы</h3>
            {% if courses_progress %}
                <ul>
                    {% for course_progress in courses_progress %}
                        <li>
                            <h4><a href="{% url 'course_detail' course_progress.course.id %}">{{ course_progress.course.title }}</a></h4>
                            <p>Прогресс: {{ course_progress.progress_percent }}%</p>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Вы не записаны ни на один курс.</p>
            {% endif %}
            <p><a href="{% url 'home' %}">На главную</a></p>
        </div>

        <div class="sidebar-profile">
            <h3>Календарь встреч</h3>
            <div id='calendar'></div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    var calendarEl = document.getElementById('calendar');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        events: [
                            {% for meeting in meetings_host %}
                            {
                                title: '{{ meeting.title|escapejs }}',
                                start: '{{ meeting.start_time|date:"c" }}',
                                end: '{{ meeting.end_time|date:"c" }}',
                                url: '{% url "meeting_detail" meeting.id %}'
                            },
                            {% endfor %}
                            {% for meeting in meetings_participant %}
                            {
                                title: '{{ meeting.title|escapejs }}',
                                start: '{{ meeting.start_time|date:"c" }}',
                                end: '{{ meeting.end_time|date:"c" }}',
                                url: '{% url "meeting_detail" meeting.id %}'
                            },
                            {% endfor %}
                        ]
                    });
                    calendar.render();
                });
            </script>

            <h3>Сегодняшние встречи</h3>
            <p>{{ today }} ({{ today_weekday }})</p>
            {% if today_meetings %}
                <ul>
                    {% for meeting in today_meetings %}
                        <li>
                            <a href="{% url 'meeting_detail' meeting.id %}">{{ meeting.title }}</a>: {{ meeting.start_time|time:"H:i" }} - {{ meeting.end_time|time:"H:i" }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>На сегодня встреч нет.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
